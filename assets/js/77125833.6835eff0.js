"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[3205],{3780:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"tutorial-Preprocessor/Deploying your Preprocessor","title":"Deploying Preprocessors","description":"Preprocessors are pluggable software services within the Federated Open-Source Platform and Services (FOSPS) that automatically annotate Electronic Product Information (ePIs) for use in the focusing mechanism. They read the Package Leaflet of an ePI and add semantic annotations to the text, preparing the raw ePI resource to become a preprocessed ePI (p(ePI)).","source":"@site/docs/tutorial-Preprocessor/4 - Deploying your Preprocessor.md","sourceDirName":"tutorial-Preprocessor","slug":"/tutorial-Preprocessor/Deploying your Preprocessor","permalink":"/docs/tutorial-Preprocessor/Deploying your Preprocessor","draft":false,"unlisted":false,"editUrl":"https://github.com/gravitate-health/gravitate-health.github.io/tree/main/docs/tutorial-Preprocessor/4 - Deploying your Preprocessor.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Basic ePI Annotation","permalink":"/docs/tutorial-Preprocessor/Basic Annotation"},"next":{"title":"Documentation: Testing Preprocessor Services","permalink":"/docs/tutorial-Preprocessor/Testing your Preprocessor"}}');var t=n(4848),o=n(8453);const i={},a="Deploying Preprocessors",c={},l=[{value:"1. Preprocessor Identification Label",id:"1-preprocessor-identification-label",level:2},{value:"2. Deployment Examples",id:"2-deployment-examples",level:2},{value:"2.1 Kubernetes Deployment",id:"21-kubernetes-deployment",level:3},{value:"2.2 Docker Deployment",id:"22-docker-deployment",level:3}];function p(e){const r={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"deploying-preprocessors",children:"Deploying Preprocessors"})}),"\n",(0,t.jsx)(r.p,{children:"Preprocessors are pluggable software services within the Federated Open-Source Platform and Services (FOSPS) that automatically annotate Electronic Product Information (ePIs) for use in the focusing mechanism. They read the Package Leaflet of an ePI and add semantic annotations to the text, preparing the raw ePI resource to become a preprocessed ePI (p(ePI))."}),"\n",(0,t.jsxs)(r.p,{children:["The preprocessor service must implement an endpoint located at the path ",(0,t.jsx)(r.code,{children:"/preprocess"})," (specified in ",(0,t.jsx)(r.a,{href:"https://raw.githubusercontent.com/Gravitate-Health/preprocessing-service-example/refs/heads/main/openapi.yaml",children:"OpenAPI"}),")and listen for HTTP connections. The focusing manager will determine automatically the port of the preprocessor (selecting the first one available to it)."]}),"\n",(0,t.jsx)(r.h2,{id:"1-preprocessor-identification-label",children:"1. Preprocessor Identification Label"}),"\n",(0,t.jsxs)(r.p,{children:["For a preprocessor service to be automatically discovered and invoked by the ",(0,t.jsx)(r.strong,{children:"Focusing Manager"}),", its Kubernetes Service YAML file must include a specific label selector in the metadata."]}),"\n",(0,t.jsxs)(r.p,{children:["The label that identifies a preprocessor service is:\n",(0,t.jsx)(r.code,{children:'eu.gravitate-health.fosps.preprocessing: "True"'})]}),"\n",(0,t.jsx)(r.h2,{id:"2-deployment-examples",children:"2. Deployment Examples"}),"\n",(0,t.jsx)(r.p,{children:"Preprocessors are internal services and do not require gateway configuration to proxy petitions, as they are accessed internally within the Kubernetes cluster."}),"\n",(0,t.jsx)(r.h3,{id:"21-kubernetes-deployment",children:"2.1 Kubernetes Deployment"}),"\n",(0,t.jsxs)(r.p,{children:["To ensure the Focusing Manager can correctly discover the preprocessor, the service must be deployed within the ",(0,t.jsx)(r.strong,{children:"same Kubernetes namespace"})," as the Focusing Manager."]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"Steps for Deployment:"})}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsx)(r.li,{children:"Build your preprocessor service into a Docker image and upload it to a registry accessible by the Kubernetes cluster."}),"\n",(0,t.jsxs)(r.li,{children:["Apply the Kubernetes Service configuration (e.g., ",(0,t.jsx)(r.code,{children:"001_preprocessing-service.yaml"}),"). This file ",(0,t.jsx)(r.strong,{children:"must contain the discovery label"})," within the metadata section of the service definition."]}),"\n",(0,t.jsxs)(r.li,{children:["Apply the Kubernetes Deployment configuration (e.g., ",(0,t.jsx)(r.code,{children:"002_preprocessing-deployment.yaml"}),")."]}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.em,{children:(0,t.jsx)(r.strong,{children:"Example Kubernetes Service Snippet (Focusing Manager Discovery):"})})}),"\n",(0,t.jsxs)(r.p,{children:["The service definition must include the required label under ",(0,t.jsx)(r.code,{children:"metadata.labels"})," and define the port on which the service listens (typically port 3000 internally):"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-yaml",children:'apiVersion: v1\nkind: Service\nmetadata:\n  name: preprocessing-service-example # Internal service name\n  namespace: <namespace_of_focusing_manager>\n  labels:\n    eu.gravitate-health.fosps.preprocessing: "True" # Required Label\nspec:\n  selector:\n    app: preprocessing-service-example # Matches the deployment label\n  ports:\n    - port: 3000\n      targetPort: 3000\n'})}),"\n",(0,t.jsx)(r.p,{children:"(Label Structure)"}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.em,{children:(0,t.jsx)(r.strong,{children:"Example Kubernetes Deployment Snippet (Using the same namespace):"})})}),"\n",(0,t.jsx)(r.p,{children:"The deployment links the image and ensures the service runs in the correct namespace:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-yaml",children:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: preprocessing-deployment\n  namespace: <namespace_of_focusing_manager>\nspec:\n  selector:\n    matchLabels:\n      app: preprocessing-service-example\n  template:\n    metadata:\n      labels:\n        app: preprocessing-service-example\n    spec:\n      containers:\n      - name: preprocessor\n        image: <docker-registry>/<your_image>:latest\n        ports:\n        - containerPort: 3000\n"})}),"\n",(0,t.jsx)(r.p,{children:"To apply the files (assuming they are saved in the current directory and deployment files match the pattern found in the sources):"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"kubectl apply -f 001_preprocessing-service-example-service.yaml\nkubectl apply -f 002_preprocessing-service-example-deployment.yaml\n"})}),"\n",(0,t.jsx)(r.p,{children:"(Command Structure)"}),"\n",(0,t.jsxs)(r.p,{children:["Once deployed, the service will be internally accessible within the cluster using a URL format similar to: ",(0,t.jsx)(r.code,{children:"http://<service-name>.<namespace>.svc.cluster.local:3000/preprocess"}),"."]}),"\n",(0,t.jsx)(r.h3,{id:"22-docker-deployment",children:"2.2 Docker Deployment"}),"\n",(0,t.jsxs)(r.p,{children:["A small version of FOSPS can be execute locally for development purposes. This is packaged in ",(0,t.jsx)(r.a,{href:"https://github.com/Gravitate-Health/focusing-SDK",children:"focusing-SDK"}),". The deployment of preprocessors is essentially the same, following simple rules:"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["The preprocessors need to be on the same network as the focusing manager (which in the SDK is ",(0,t.jsx)(r.code,{children:"focusing-network"}),")."]}),"\n",(0,t.jsxs)(r.li,{children:["The preprocessors need to be labeled ",(0,t.jsx)(r.code,{children:"eu.gravitate-health.fosps.preprocessing=True"})]}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.em,{children:(0,t.jsx)(r.strong,{children:"Example Docker-compose Deployment Snippet:"})})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"  preprocessing-service-example:\n    container_name: preprocessing-service-example\n    image: <your-custom-preprocessor-image>\n    environment:\n      ENVIRONMENT: dev\n    networks:\n      - focusing-network\n    restart: unless-stopped\n    # Service discovery labels - used by focusing manager to detect this preprocessor\n    labels:\n      eu.gravitate-health.fosps.preprocessing: True\n"})})]})}function d(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>i,x:()=>a});var s=n(6540);const t={},o=s.createContext(t);function i(e){const r=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(o.Provider,{value:r},e.children)}}}]);