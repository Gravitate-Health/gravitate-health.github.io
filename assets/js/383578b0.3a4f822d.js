"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[8177],{2832:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"tutorial-Preprocessor/Develop a Basic Preprocessor","title":"Develop a Basic Preprocessor","description":"You will need to produce a Docker container that implements a specific HTTP REST interface. See the OpenAPI specification for complete details.","source":"@site/docs/tutorial-Preprocessor/1 - Develop a Basic Preprocessor.md","sourceDirName":"tutorial-Preprocessor","slug":"/tutorial-Preprocessor/Develop a Basic Preprocessor","permalink":"/docs/tutorial-Preprocessor/Develop a Basic Preprocessor","draft":false,"unlisted":false,"editUrl":"https://github.com/gravitate-health/gravitate-health.github.io/tree/main/docs/tutorial-Preprocessor/1 - Develop a Basic Preprocessor.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Introduction","permalink":"/docs/tutorial-Preprocessor/Introduction"},"next":{"title":"Basic ePI Annotation","permalink":"/docs/tutorial-Preprocessor/Basic Annotation"}}');var i=n(4848),t=n(8453);const o={},a="Develop a Basic Preprocessor",l={},c=[{value:"Forking a Template",id:"forking-a-template",level:2},{value:"JavaScript",id:"javascript",level:3},{value:"Python",id:"python",level:3},{value:"Generic Approach using OpenAPI Generator",id:"generic-approach-using-openapi-generator",level:2},{value:"1. Generate a server stub",id:"1-generate-a-server-stub",level:3},{value:"2. Implement business logic",id:"2-implement-business-logic",level:3},{value:"3. Build &amp; run Docker image",id:"3-build--run-docker-image",level:3},{value:"Concrete Examples by Popular Languages",id:"concrete-examples-by-popular-languages",level:2},{value:"Python \u2013 Flask Server",id:"python--flask-server",level:3},{value:"Java \u2013 Spring Boot Server",id:"java--spring-boot-server",level:3}];function p(e){const r={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"develop-a-basic-preprocessor",children:"Develop a Basic Preprocessor"})}),"\n",(0,i.jsx)(r.admonition,{title:"Requirements",type:"info",children:(0,i.jsxs)(r.p,{children:["You will need to produce a Docker container that implements a specific HTTP REST interface. See the ",(0,i.jsx)(r.a,{href:"https://raw.githubusercontent.com/Gravitate-Health/preprocessing-service-example/refs/heads/main/openapi.yaml",children:"OpenAPI specification"})," for complete details."]})}),"\n",(0,i.jsx)(r.p,{children:"There are several alternatives to accomplish this:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Fork an existing template"})," - Start with a project similar to your needs (language, frameworks, process, etc.)"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Use a code generator"})," - Create a new project with almost everything ready to run the server"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Build from scratch"})," - Create your project from the ground up, as long as it follows the OpenAPI specification"]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"Select the development path that best fits your needs and expertise."}),"\n",(0,i.jsx)(r.h2,{id:"forking-a-template",children:"Forking a Template"}),"\n",(0,i.jsx)(r.h3,{id:"javascript",children:"JavaScript"}),"\n",(0,i.jsxs)(r.p,{children:["\ud83d\udce6 ",(0,i.jsx)(r.strong,{children:"Repository:"})," ",(0,i.jsx)(r.a,{href:"https://github.com/Gravitate-Health/preprocessing-service-example",children:"preprocessing-service-example"})]}),"\n",(0,i.jsx)(r.p,{children:"This is a simple preprocessor written in TypeScript/JavaScript."}),"\n",(0,i.jsx)(r.admonition,{title:"Quick Start",type:"tip",children:(0,i.jsxs)(r.p,{children:["You can write the business logic in ",(0,i.jsx)(r.code,{children:"src/controllers/preprocessing.ts"}),". The template is ready with Dockerfile and even Kubernetes YAML definitions."]})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Key Features:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Pre-configured TypeScript environment"}),"\n",(0,i.jsx)(r.li,{children:"Docker and Kubernetes deployment files included"}),"\n",(0,i.jsx)(r.li,{children:"Ready-to-use project structure"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Getting Started:"})}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Fork the repository"}),"\n",(0,i.jsx)(r.li,{children:"Add your dependencies"}),"\n",(0,i.jsx)(r.li,{children:"Write your code"}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"python",children:"Python"}),"\n",(0,i.jsxs)(r.p,{children:["\ud83d\udce6 ",(0,i.jsx)(r.strong,{children:"Repository:"})," ",(0,i.jsx)(r.a,{href:"https://github.com/Gravitate-Health/preprocessing-service-example-python",children:"preprocessing-service-example-python"})]}),"\n",(0,i.jsx)(r.p,{children:"This is another simple preprocessor written in Python."}),"\n",(0,i.jsx)(r.admonition,{title:"Quick Start",type:"tip",children:(0,i.jsxs)(r.p,{children:["It's ready to fork and develop your own preprocessor from it. Start at ",(0,i.jsx)(r.code,{children:"preprocessor\\controllers\\preprocess_controller.py"})," \u2014 the function is ",(0,i.jsx)(r.code,{children:"_apply_preprocess"}),"."]})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Key Features:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Components to access common ePI elements such as the composition"}),"\n",(0,i.jsxs)(r.li,{children:["Built-in support for managing ",(0,i.jsx)(r.a,{href:"https://build.fhir.org/ig/hl7-eu/gravitate-health/StructureDefinition-HtmlElementLink.html",children:(0,i.jsx)(r.code,{children:"HtmlElementLink"})})," Extension"]}),"\n",(0,i.jsx)(r.li,{children:"Tools to extract and manipulate HTML content"}),"\n",(0,i.jsx)(r.li,{children:"Embedded ePI examples for testing"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Getting Started:"})}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Fork the repository"}),"\n",(0,i.jsx)(r.li,{children:"Add your dependencies"}),"\n",(0,i.jsx)(r.li,{children:"Write your code"}),"\n",(0,i.jsx)(r.li,{children:"Test it with the embedded ePI examples"}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"generic-approach-using-openapi-generator",children:"Generic Approach using OpenAPI Generator"}),"\n",(0,i.jsxs)(r.p,{children:["You can opt to use an API server generator, for example ",(0,i.jsx)(r.a,{href:"https://github.com/OpenAPITools/openapi-generator",children:"OpenAPI Generator"}),", which will be explained in detail."]}),"\n",(0,i.jsxs)(r.p,{children:["\ud83d\udccb ",(0,i.jsx)(r.strong,{children:"Preprocessor OpenAPI Spec:"})]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"https://raw.githubusercontent.com/Gravitate-Health/preprocessing-service-example/refs/heads/main/openapi.yaml\n"})}),"\n",(0,i.jsx)(r.p,{children:"You can create servers with stubs in any of the supported languages."}),"\n",(0,i.jsx)(r.admonition,{title:"Docker Requirements",type:"warning",children:(0,i.jsx)(r.p,{children:"You may need to create a Dockerfile for the Preprocessor service. Remember to expose the port where the API is published."})}),"\n",(0,i.jsx)(r.admonition,{title:"Installation-Free Approach",type:"info",children:(0,i.jsxs)(r.p,{children:["Using the official Docker image avoids installing Java or OpenAPI Generator locally. You will need ",(0,i.jsx)(r.a,{href:"https://docs.docker.com/engine/install/",children:"Docker installed"}),"."]})}),"\n",(0,i.jsx)(r.h3,{id:"1-generate-a-server-stub",children:"1. Generate a server stub"}),"\n",(0,i.jsx)(r.p,{children:"Use the dockerized generator:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"docker run --rm \\\n  -v ${PWD}:/local --user $(id -u):$(id -g) \\\n  openapitools/openapi-generator-cli generate \\\n  -i https://raw.githubusercontent.com/Gravitate-Health/preprocessing-service-example/refs/heads/main/openapi.yaml \\\n  -g <language> \\\n  -o /local/out/<language-server>\n"})}),"\n",(0,i.jsxs)(r.p,{children:["Where ",(0,i.jsx)(r.code,{children:"<language>"})," can be:"]}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Language"}),(0,i.jsx)(r.th,{children:"Generator"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Java Spring"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"spring"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Python Flask"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"python-flask"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Node/JavaScript Express"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"nodejs-express-server"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Go Gin"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"go-gin-server"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Rust Hyper/Tower"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"rust-server"})})]})]})]}),"\n",(0,i.jsxs)(r.p,{children:["Checkout the full list of supported languages (+ frameworks) in openapi-generator's list of ",(0,i.jsx)(r.a,{href:"https://openapi-generator.tech/docs/generators#server-generators",children:"SERVER Generators"})]}),"\n",(0,i.jsx)(r.h3,{id:"2-implement-business-logic",children:"2. Implement business logic"}),"\n",(0,i.jsx)(r.p,{children:"After generation:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Each endpoint will have a handler stub."}),"\n",(0,i.jsx)(r.li,{children:"Implement your logic inside those functions."}),"\n",(0,i.jsx)(r.li,{children:"Avoid modifying generated models or interfaces (regenerate at any time)."}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"3-build--run-docker-image",children:"3. Build & run Docker image"}),"\n",(0,i.jsxs)(r.p,{children:["Ensure the docker image can be built, if there isn't any Dockerfile ",(0,i.jsx)(r.a,{href:"https://www.docker.com/blog/how-to-create-dockerfiles-with-genai/",children:"create one for your project"}),"."]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"docker build -t my-service .\ndocker run -p 8080:8080 my-service\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"concrete-examples-by-popular-languages",children:"Concrete Examples by Popular Languages"}),"\n",(0,i.jsx)(r.h3,{id:"python--flask-server",children:"Python \u2013 Flask Server"}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Generate"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"docker run --rm \\\n  -v ${PWD}:/local --user $(id -u):$(id -g) \\\n  openapitools/openapi-generator-cli generate \\\n  -i https://raw.githubusercontent.com/Gravitate-Health/preprocessing-service-example/refs/heads/main/openapi.yaml \\\n  -g python-flask \\\n  -o /local/generated/python-flask \\\n  --additional-properties=packageName=preprocessor\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Project Structure"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-plaintext",children:"generated/python-flask/\n \u251c\u2500\u2500 __main__.py  # Flask root\n \u251c\u2500\u2500 openapi_server\n |   \u251c\u2500\u2500 controllers/  # handlers\n |   \u251c\u2500\u2500 models/  \n |   \u251c\u2500\u2500 api/  \n |   \u251c\u2500\u2500 ...\n \u251c\u2500\u2500 Dockerfile\n \u251c\u2500\u2500 requirements.txt\n \u251c\u2500\u2500 ...\n"})}),"\n",(0,i.jsx)(r.p,{children:"Implement your code in:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"openapi_server/controllers/preprocess_controller.py\n"})}),"\n",(0,i.jsx)(r.admonition,{title:"FHIR Helper Libraries",type:"tip",children:(0,i.jsxs)(r.p,{children:["You may use FHIR Python Helper modules like ",(0,i.jsx)(r.a,{href:"https://github.com/nazrulworld/fhir.resources",children:"fhir.resources"})," (Pydantic-based models)."]})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Dockerfile (Flask)"})}),"\n",(0,i.jsx)(r.p,{children:"Generator already provides a working Dockerfile."}),"\n",(0,i.jsx)(r.admonition,{title:"Troubleshooting",type:"note",children:(0,i.jsxs)(r.p,{children:["If there is an issue, try changing ",(0,i.jsx)(r.code,{children:"FROM python:3-alpine"})," in the dockerfile to ",(0,i.jsx)(r.code,{children:"FROM python:3.11-alpine"}),"."]})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h3,{id:"java--spring-boot-server",children:"Java \u2013 Spring Boot Server"}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Generate"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"docker run --rm \\\n  -v ${PWD}:/local --user $(id -u):$(id -g)\\\n  openapitools/openapi-generator-cli generate \\\n  -i https://raw.githubusercontent.com/Gravitate-Health/preprocessing-service-example/refs/heads/main/openapi.yaml \\\n  -g spring \\\n  --additional-properties=java8=true \\\n  -o /local/generated/spring\n"})}),"\n",(0,i.jsx)(r.p,{children:"The generated project already includes Maven or Gradle support."}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Project Structure (Spring)"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-plaintext",children:"generated/spring/\n \u251c\u2500\u2500 pom.xml\n \u251c\u2500\u2500 src/main/java/org/openapitools/api/...   # handlers\n \u251c\u2500\u2500 src/main/java/org/openapitools/model/... # models\n \u251c\u2500\u2500 ...\n"})}),"\n",(0,i.jsx)(r.p,{children:"Write your logic inside classes under:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-java",children:"src/main/java/org/openapitools/api/PreprocessApiController.java\n"})}),"\n",(0,i.jsxs)(r.p,{children:["You may use FHIR Helper packages like ",(0,i.jsx)(r.a,{href:"https://hapifhir.io/",children:"HAPI FHIR"}),", ",(0,i.jsx)(r.code,{children:"hapi-fhir-base"})," provides parsing and manipulation."]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Example Dockerfile (Java Spring)"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:(0,i.jsx)(r.code,{children:"generated/spring/Dockerfile"})})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-Dockerfile",children:'FROM maven:3.9-eclipse-temurin-17 AS build\nWORKDIR /workspace\n\n# copy pom / mvnw first to leverage Docker layer cache if sources change often\nCOPY pom.xml ./\nCOPY src ./src\n\n# build the project (skip tests for faster builds by default)\nRUN mvn -B -DskipTests package\n\n# normalize produced jar name for the next stage\nRUN cp target/*.jar app.jar\n\nFROM eclipse-temurin:17-jre AS runtime\nWORKDIR /app\n\n# copy the assembled jar from the build stage\nCOPY --from=build /workspace/app.jar ./app.jar\n\n# default Spring Boot port\nEXPOSE 8080\n\n# allow passing JVM options with JAVA_OPTS\nENV JAVA_OPTS=""\n\nENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar /app/app.jar"]\n'})})]})}function d(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>a});var s=n(6540);const i={},t=s.createContext(i);function o(e){const r=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(t.Provider,{value:r},e.children)}}}]);