"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[177],{2832:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>t,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"tutorial-Preprocessor/Develop a Basic Preprocessor","title":"Develop a Basic Preprocessor","description":"In general you will need to produce a Docker container that implements a specific http REST interface (see this openapi specification).","source":"@site/docs/tutorial-Preprocessor/1 - Develop a Basic Preprocessor.md","sourceDirName":"tutorial-Preprocessor","slug":"/tutorial-Preprocessor/Develop a Basic Preprocessor","permalink":"/docs/tutorial-Preprocessor/Develop a Basic Preprocessor","draft":false,"unlisted":false,"editUrl":"https://github.com/gravitate-health/gravitate-health.github.io/tree/main/docs/tutorial-Preprocessor/1 - Develop a Basic Preprocessor.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Introduction","permalink":"/docs/tutorial-Preprocessor/Introduction"},"next":{"title":"Basic Annotation","permalink":"/docs/tutorial-Preprocessor/Basic Annotation"}}');var i=n(4848),a=n(8453);const o={},t="Develop a Basic Preprocessor",l={},c=[{value:"Forking template",id:"forking-template",level:2},{value:"Generic Approach using OpenAPI Generator",id:"generic-approach-using-openapi-generator",level:2},{value:"1. Generate a server stub",id:"1-generate-a-server-stub",level:3},{value:"2. Implement business logic",id:"2-implement-business-logic",level:3},{value:"3. Build &amp; run Docker image",id:"3-build--run-docker-image",level:3},{value:"Concrete Examples by Popular Languages",id:"concrete-examples-by-popular-languages",level:2},{value:"Python \u2013 Flask Server",id:"python--flask-server",level:3},{value:"Java \u2013 Spring Boot Server",id:"java--spring-boot-server",level:3}];function p(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"develop-a-basic-preprocessor",children:"Develop a Basic Preprocessor"})}),"\n",(0,i.jsxs)(r.p,{children:["In general you will need to produce a Docker container that implements a specific http REST interface (see ",(0,i.jsx)(r.a,{href:"https://raw.githubusercontent.com/Gravitate-Health/preprocessing-service-example/refs/heads/main/openapi.yaml",children:"this openapi specification"}),")."]}),"\n",(0,i.jsx)(r.p,{children:"There are several alternatives to do this, one is to fork an existing project that is similar to what you what (languaje, frameworks, process, etc...). Another option is to use a code generator to create a new proyect with almost everything ready to run the server. And, of course, you may also create your project from scratch, as long as it follows the conditions above."}),"\n",(0,i.jsx)(r.h2,{id:"forking-template",children:"Forking template"}),"\n",(0,i.jsx)(r.p,{children:"Fork:"}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.a,{href:"https://github.com/Gravitate-Health/preprocessing-service-example",children:"https://github.com/Gravitate-Health/preprocessing-service-example"}),"."]}),"\n",(0,i.jsxs)(r.p,{children:["This is a simple preprocessor written in TrueScript/JavaScript.\nYou can write the business logic in ",(0,i.jsx)(r.code,{children:"src/controllers/preporcessing.ts"}),".\nIt is ready with Docker file, and even kubernetes yaml definitions."]}),"\n",(0,i.jsx)(r.h2,{id:"generic-approach-using-openapi-generator",children:"Generic Approach using OpenAPI Generator"}),"\n",(0,i.jsxs)(r.p,{children:["You can opt to use an API sever generator, for example ",(0,i.jsx)(r.a,{href:"https://github.com/OpenAPITools/openapi-generator",children:"OpenAPI Generator"}),", which will be explained in detail.\nPreprocessor OpenAPI Spec is in:"]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.a,{href:"https://raw.githubusercontent.com/Gravitate-Health/preprocessing-service-example/refs/heads/main/openapi.yaml",children:"https://raw.githubusercontent.com/Gravitate-Health/preprocessing-service-example/refs/heads/main/openapi.yaml"})}),"\n",(0,i.jsx)(r.p,{children:"You can create servers with stubs in any of the supported languages.\nYou may need to create Dockefile for the Preprocessor service; rembember to expose the port where the API is published."}),"\n",(0,i.jsxs)(r.p,{children:["Using the official Docker image avoids installing Java or OpenAPI Generator locally. You will need ",(0,i.jsx)(r.a,{href:"https://docs.docker.com/engine/install/",children:"docker installed"}),"."]}),"\n",(0,i.jsx)(r.h3,{id:"1-generate-a-server-stub",children:"1. Generate a server stub"}),"\n",(0,i.jsx)(r.p,{children:"Use the dockerized generator:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-sh",children:"docker run --rm \\\n  -v ${PWD}:/local --user $(id -u):$(id -g) \\\n  openapitools/openapi-generator-cli generate \\\n  -i https://raw.githubusercontent.com/Gravitate-Health/preprocessing-service-example/refs/heads/main/openapi.yaml \\\n  -g <language> \\\n  -o /local/out/<language-server>\n"})}),"\n",(0,i.jsxs)(r.p,{children:["Where ",(0,i.jsx)(r.code,{children:"<language>"})," can be:"]}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Language"}),(0,i.jsx)(r.th,{children:"Generator"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Java Spring"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"spring"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Python Flask"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"python-flask"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Node/JavaScript Express"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"nodejs-express-server"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Go Gin"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"go-gin-server"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Rust Hyper/Tower"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"rust-server"})})]})]})]}),"\n",(0,i.jsxs)(r.p,{children:["Checkout the full list of supported languajes (+ frameworks) in openapi-generator's list of ",(0,i.jsx)(r.a,{href:"https://openapi-generator.tech/docs/generators#server-generators",children:"SERVER Gerenators"})]}),"\n",(0,i.jsx)(r.h3,{id:"2-implement-business-logic",children:"2. Implement business logic"}),"\n",(0,i.jsx)(r.p,{children:"After generation:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Each endpoint will have a handler stub."}),"\n",(0,i.jsx)(r.li,{children:"Implement your logic inside those functions."}),"\n",(0,i.jsx)(r.li,{children:"Avoid modifying generated models or interfaces (regenerate at any time)."}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"3-build--run-docker-image",children:"3. Build & run Docker image"}),"\n",(0,i.jsxs)(r.p,{children:["Ensure the docker image can be built, if there isn't any Dockerfile ",(0,i.jsx)(r.a,{href:"https://www.docker.com/blog/how-to-create-dockerfiles-with-genai/",children:"create one for your project"}),"."]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-sh",children:"docker build -t my-service .\ndocker run -p 8080:8080 my-service\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"concrete-examples-by-popular-languages",children:"Concrete Examples by Popular Languages"}),"\n",(0,i.jsx)(r.h3,{id:"python--flask-server",children:"Python \u2013 Flask Server"}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Generate"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-sh",children:"docker run --rm \\\n  -v ${PWD}:/local --user $(id -u):$(id -g) \\\n  openapitools/openapi-generator-cli generate \\\n  -i https://raw.githubusercontent.com/Gravitate-Health/preprocessing-service-example/refs/heads/main/openapi.yaml \\\n  -g python-flask \\\n  -o /local/generated/python-flask\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Project Structure"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"generated/python-flask/\n \u251c\u2500\u2500 __main__.py  # Flask root\n \u251c\u2500\u2500 openapi_server\n |   \u251c\u2500\u2500 controllers/  # handlers\n |   \u251c\u2500\u2500 models/  \n |   \u251c\u2500\u2500 api/  \n |   \u251c\u2500\u2500 ...\n \u251c\u2500\u2500 Dockerfile\n \u251c\u2500\u2500 requirements.txt\n \u251c\u2500\u2500 ...\n"})}),"\n",(0,i.jsx)(r.p,{children:"Implement your code in:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"openapi_server/controllers/preprocess_controller.py\n"})}),"\n",(0,i.jsxs)(r.p,{children:["You may use FHIR Python Helper modules like ",(0,i.jsx)(r.a,{href:"https://github.com/nazrulworld/fhir.resources",children:"fhir.resources"})," (Pydantic-based models)."]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Dockerfile (Flask)"})}),"\n",(0,i.jsx)(r.p,{children:"Generator already provides a working Dockerfile."}),"\n",(0,i.jsxs)(r.p,{children:["If there is an issue, try changing ",(0,i.jsx)(r.code,{children:"FROM python:3-alpine"})," in the dockerfile to ",(0,i.jsx)(r.code,{children:"FROM python:3.11-alpine"}),"."]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h3,{id:"java--spring-boot-server",children:"Java \u2013 Spring Boot Server"}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Generate"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-sh",children:"docker run --rm \\\n  -v ${PWD}:/local --user $(id -u):$(id -g)\\\n  openapitools/openapi-generator-cli generate \\\n  -i https://raw.githubusercontent.com/Gravitate-Health/preprocessing-service-example/refs/heads/main/openapi.yaml \\\n  -g spring \\\n  --additional-properties=java8=true \\\n  -o /local/generated/spring\n"})}),"\n",(0,i.jsx)(r.p,{children:"The generated project already includes Maven or Gradle support."}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Project Structure (Spring)"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"generated/spring/\n \u251c\u2500\u2500 pom.xml\n \u251c\u2500\u2500 src/main/java/org/openapitools/api/...   # handlers\n \u251c\u2500\u2500 src/main/java/org/openapitools/model/... # models\n \u251c\u2500\u2500 ...\n"})}),"\n",(0,i.jsx)(r.p,{children:"Write your logic inside classes under:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"src/main/java/org/openapitools/api/PreprocessApiController.java\n"})}),"\n",(0,i.jsxs)(r.p,{children:["You may use FHIR Helper packages like ",(0,i.jsx)(r.a,{href:"https://hapifhir.io/",children:"HAPI FHIR"}),", ",(0,i.jsx)(r.code,{children:"hapi-fhir-base"})," provides parsing and manipulation."]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Example Dockerfile (Java Spring)"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:(0,i.jsx)(r.code,{children:"generated/spring/Dockerfile"})})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-Dockerfile",children:'FROM maven:3.9-eclipse-temurin-17 AS build\nWORKDIR /workspace\n\n# copy pom / mvnw first to leverage Docker layer cache if sources change often\nCOPY pom.xml ./\nCOPY src ./src\n\n# build the project (skip tests for faster builds by default)\nRUN mvn -B -DskipTests package\n\n# normalize produced jar name for the next stage\nRUN cp target/*.jar app.jar\n\nFROM eclipse-temurin:17-jre AS runtime\nWORKDIR /app\n\n# copy the assembled jar from the build stage\nCOPY --from=build /workspace/app.jar ./app.jar\n\n# default Spring Boot port\nEXPOSE 8080\n\n# allow passing JVM options with JAVA_OPTS\nENV JAVA_OPTS=""\n\nENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar /app/app.jar"]\n'})})]})}function d(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>t});var s=n(6540);const i={},a=s.createContext(i);function o(e){const r=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function t(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(a.Provider,{value:r},e.children)}}}]);