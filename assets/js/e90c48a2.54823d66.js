"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5787],{667:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"preprocessor","title":"Preprocessor","description":"A Preprocessor is a pluggable service that semantically annotates raw ePIs using standard terminologies (like SNOMED-CT or ICPC-2) to generate a Preprocessed ePI (p(ePI)).","source":"@site/ref/preprocessor.md","sourceDirName":".","slug":"/preprocessor","permalink":"/reference/preprocessor","draft":false,"unlisted":false,"editUrl":"https://github.com/gravitate-health/gravitate-health.github.io/tree/main/ref/preprocessor.md","tags":[{"inline":true,"label":"focusing","permalink":"/reference/tags/focusing"},{"inline":true,"label":"preprocessing","permalink":"/reference/tags/preprocessing"},{"inline":true,"label":"semantic-annotation","permalink":"/reference/tags/semantic-annotation"},{"inline":true,"label":"service","permalink":"/reference/tags/service"}],"version":"current","sidebarPosition":33,"frontMatter":{"sidebar_position":33,"title":"Preprocessor","tags":["focusing","preprocessing","semantic-annotation","service"]},"sidebar":"tutorialSidebar","previous":{"title":"Focusing Manager","permalink":"/reference/focusing-manager"},"next":{"title":"p(ePI) - Preprocessed ePI","permalink":"/reference/p-epi"}}');var s=i(4848),t=i(8453);const l={sidebar_position:33,title:"Preprocessor",tags:["focusing","preprocessing","semantic-annotation","service"]},a="Preprocessor",o={},c=[{value:"Purpose",id:"purpose",level:2},{value:"Technical Implementation",id:"technical-implementation",level:2},{value:"Required Endpoint",id:"required-endpoint",level:3},{value:"Service Discovery",id:"service-discovery",level:3},{value:"Containerization",id:"containerization",level:3},{value:"Annotation Mechanism",id:"annotation-mechanism",level:2},{value:"1. Add HtmlElementLink Extensions",id:"1-add-htmlelementlink-extensions",level:3},{value:"2. Modify HTML Narrative",id:"2-modify-html-narrative",level:3},{value:"Stacking Support",id:"stacking-support",level:2},{value:"HTML Modification Rules",id:"html-modification-rules",level:2},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"preprocessor",children:"Preprocessor"})}),"\n",(0,s.jsxs)(n.p,{children:["A ",(0,s.jsx)(n.strong,{children:"Preprocessor"})," is a pluggable service that semantically annotates raw ",(0,s.jsx)(n.a,{href:"/reference/epi",children:"ePIs"})," using ",(0,s.jsx)(n.a,{href:"/reference/standard-terminologies",children:"standard terminologies"})," (like SNOMED-CT or ICPC-2) to generate a ",(0,s.jsx)(n.a,{href:"/reference/p-epi",children:"Preprocessed ePI (p(ePI))"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"purpose",children:"Purpose"}),"\n",(0,s.jsxs)(n.p,{children:["Preprocessors transform raw ",(0,s.jsx)(n.a,{href:"/reference/epi",children:"ePI"})," into ",(0,s.jsx)(n.a,{href:"/reference/p-epi",children:"p(ePI)"})," by:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Reading ePI narrative text"}),"\n",(0,s.jsx)(n.li,{children:"Identifying medically relevant sections"}),"\n",(0,s.jsxs)(n.li,{children:["Annotating with ",(0,s.jsx)(n.a,{href:"/reference/standard-terminologies",children:"standard terminology"})," codes"]}),"\n",(0,s.jsx)(n.li,{children:"Embedding annotations as HTML class attributes"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"technical-implementation",children:"Technical Implementation"}),"\n",(0,s.jsx)(n.h3,{id:"required-endpoint",children:"Required Endpoint"}),"\n",(0,s.jsxs)(n.p,{children:["Must implement ",(0,s.jsx)(n.code,{children:"/preprocess"})," REST endpoint:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Input"}),": ePI Bundle (FHIR JSON)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Output"}),": p(ePI) Bundle (FHIR JSON)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Specification"}),": ",(0,s.jsx)(n.a,{href:"https://github.com/Gravitate-Health/preprocessing-service-example/blob/main/openapi.yaml",children:"OpenAPI definition"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"service-discovery",children:"Service Discovery"}),"\n",(0,s.jsx)(n.p,{children:"Must be deployed with Kubernetes label:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"eu.gravitate-health.fosps.preprocessing=true\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This enables ",(0,s.jsx)(n.a,{href:"/reference/focusing-manager",children:"Focusing Manager"})," auto-discovery."]}),"\n",(0,s.jsx)(n.h3,{id:"containerization",children:"Containerization"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Packaged as Docker containers"}),"\n",(0,s.jsxs)(n.li,{children:["Deployed via ",(0,s.jsx)(n.a,{href:"/reference/kubernetes-deployment",children:"Kubernetes"})]}),"\n",(0,s.jsx)(n.li,{children:"Language/framework agnostic"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"annotation-mechanism",children:"Annotation Mechanism"}),"\n",(0,s.jsx)(n.h3,{id:"1-add-htmlelementlink-extensions",children:"1. Add HtmlElementLink Extensions"}),"\n",(0,s.jsxs)(n.p,{children:["Preprocessors add ",(0,s.jsx)(n.a,{href:"https://build.fhir.org/ig/hl7-eu/gravitate-health/StructureDefinition-HtmlElementLink.html",children:"HtmlElementLink"})," extensions to the Composition:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "extension": [{\n    "url": "elementClass",\n    "valueString": "pregnancy-warning"\n  }, {\n    "url": "concept",\n    "valueCodeableConcept": {\n      "coding": [{\n        "system": "http://snomed.info/sct",\n        "code": "77386006"\n      }]\n    }\n  }]\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"2-modify-html-narrative",children:"2. Modify HTML Narrative"}),"\n",(0,s.jsx)(n.p,{children:"Add class attributes to HTML tags in Composition.text.div:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<p class="pregnancy-warning">\n  Do not use during pregnancy.\n</p>\n'})}),"\n",(0,s.jsx)(n.h2,{id:"stacking-support",children:"Stacking Support"}),"\n",(0,s.jsxs)(n.p,{children:["Preprocessors must handle ",(0,s.jsx)(n.strong,{children:"stacking"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Input may already be ",(0,s.jsx)(n.a,{href:"/reference/p-epi",children:"p(ePI)"})," from previous preprocessor"]}),"\n",(0,s.jsx)(n.li,{children:"Avoid duplicate annotations"}),"\n",(0,s.jsx)(n.li,{children:"Append to existing class attributes (don't nest tags)"}),"\n",(0,s.jsx)(n.li,{children:"Check for existing HtmlElementLink extensions"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"html-modification-rules",children:"HTML Modification Rules"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Allowed"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Adding HTML class attributes"}),"\n",(0,s.jsxs)(n.li,{children:["Wrapping text in ",(0,s.jsx)(n.code,{children:"<span>"})," tags"]}),"\n",(0,s.jsxs)(n.li,{children:["Adding classes to existing tags (",(0,s.jsx)(n.code,{children:"<p>"}),", ",(0,s.jsx)(n.code,{children:"<h1>"}),", ",(0,s.jsx)(n.code,{children:"<li>"}),", etc.)"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Prohibited"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Removing content"}),"\n",(0,s.jsx)(n.li,{children:"Changing narrative text"}),"\n",(0,s.jsx)(n.li,{children:"Deleting HTML elements"}),"\n",(0,s.jsx)(n.li,{children:"Modifying approved wording"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,s.jsx)(n.p,{children:"Preprocessors should handle:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Heavy computation"}),": NLP models, semantic analysis"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Slow operations"}),": External API calls, database lookups"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["This allows ",(0,s.jsx)(n.a,{href:"/reference/lens",children:"Lenses"})," to remain lightweight and fast."]}),"\n",(0,s.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/reference/p-epi",children:"p(ePI)"})," - Output format"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/reference/epi",children:"ePI"})," - Input content"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/reference/standard-terminologies",children:"Standard Terminologies"})," - Annotation codes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/reference/focusing-manager",children:"Focusing Manager"})," - Orchestrator"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/reference/lens",children:"Lens"})," - Consumes annotations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/reference/focusing",children:"Focusing"})," - Overall workflow"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>a});var r=i(6540);const s={},t=r.createContext(s);function l(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);