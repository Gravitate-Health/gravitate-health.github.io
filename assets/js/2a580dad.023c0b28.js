"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2256],{4465:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"tutorial-Lens/Lens Bundler Tool Tutorial","title":"Lens Tool Bundler Tutorial","description":"This tutorial guides you through the complete workflow of using the Lens Tool Bundler to manage your FHIR Lenses - from creation to deployment.","source":"@site/docs/tutorial-Lens/6 - Lens Bundler Tool Tutorial.md","sourceDirName":"tutorial-Lens","slug":"/tutorial-Lens/Lens Bundler Tool Tutorial","permalink":"/docs/tutorial-Lens/Lens Bundler Tool Tutorial","draft":false,"unlisted":false,"editUrl":"https://github.com/gravitate-health/gravitate-health.github.io/tree/main/docs/tutorial-Lens/6 - Lens Bundler Tool Tutorial.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Testing Your Lens","permalink":"/docs/tutorial-Lens/Testing your Lens"},"next":{"title":"Official Lenses / Lens Examples","permalink":"/docs/tutorial-Lens/Examples"}}');var i=l(4848),r=l(8453);const t={},o="Lens Tool Bundler Tutorial",d={},a=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Installation",id:"installation",level:2},{value:"Workflow Overview",id:"workflow-overview",level:2},{value:"Step 1: Create a New Lens",id:"step-1-create-a-new-lens",level:2},{value:"Step 2: Bundle JavaScript into FHIR Library",id:"step-2-bundle-javascript-into-fhir-library",level:2},{value:"Step 3: Verify Bundle Integrity",id:"step-3-verify-bundle-integrity",level:2},{value:"Step 4: Test Your Lens",id:"step-4-test-your-lens",level:2},{value:"Step 5: Upload to FHIR Server",id:"step-5-upload-to-fhir-server",level:2},{value:"Updating Your Lens",id:"updating-your-lens",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Keep Metadata in Sync",id:"1-keep-metadata-in-sync",level:3},{value:"2. Version Control",id:"2-version-control",level:3},{value:"3. Test Before Upload",id:"3-test-before-upload",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"&quot;Integrity check failed&quot;",id:"integrity-check-failed",level:3},{value:"&quot;Upload failed with 400&quot;",id:"upload-failed-with-400",level:3},{value:"&quot;Test failed&quot;",id:"test-failed",level:3},{value:"CI/CD Integration",id:"cicd-integration",level:2},{value:"Additional Resources",id:"additional-resources",level:2},{value:"Quick Reference",id:"quick-reference",level:2}];function c(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"lens-tool-bundler-tutorial",children:"Lens Tool Bundler Tutorial"})}),"\n",(0,i.jsx)(n.p,{children:"This tutorial guides you through the complete workflow of using the Lens Tool Bundler to manage your FHIR Lenses - from creation to deployment."}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Node.js 18 or higher"}),"\n",(0,i.jsx)(n.li,{children:"npm or yarn package manager"}),"\n",(0,i.jsx)(n.li,{children:"A lens JavaScript file (or create one following the lens development guide)"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,i.jsx)(n.p,{children:"Install the Lens Tool Bundler globally:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm install -g @gravitate-health/lens-tool-bundler\n"})}),"\n",(0,i.jsx)(n.p,{children:"Verify the installation:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"lens-tool-bundler --version\n"})}),"\n",(0,i.jsxs)(n.admonition,{type:"tip",children:[(0,i.jsxs)(n.p,{children:["You can also use ",(0,i.jsx)(n.code,{children:"npx"})," to run commands without global installation:"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npx @gravitate-health/lens-tool-bundler COMMAND\n"})})]}),"\n",(0,i.jsx)(n.h2,{id:"workflow-overview",children:"Workflow Overview"}),"\n",(0,i.jsx)(n.p,{children:"The typical workflow for managing a lens with this tool:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Create"})," - Initialize lens files"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Bundle"})," - Convert JavaScript to FHIR Library resource"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Check"})," - Verify integrity of bundled content"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Test"})," - Run comprehensive lens tests"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Upload"})," - Deploy to FHIR server"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"step-1-create-a-new-lens",children:"Step 1: Create a New Lens"}),"\n",(0,i.jsxs)(n.p,{children:["Initialize a new lens using the ",(0,i.jsx)(n.code,{children:"new"})," command:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"lens-tool-bundler new MyLens\n"})}),"\n",(0,i.jsx)(n.p,{children:"The tool will prompt you for metadata (name, description, purpose, usage)."}),"\n",(0,i.jsxs)(n.admonition,{title:"Alternative: Use Default Values",type:"info",children:[(0,i.jsxs)(n.p,{children:["Skip the interactive prompts with the ",(0,i.jsx)(n.code,{children:"-d"})," flag:"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"lens-tool-bundler new MyLens -d\n"})}),(0,i.jsx)(n.p,{children:"This creates the lens with placeholder metadata that you can update later."})]}),"\n",(0,i.jsx)(n.p,{children:"This creates two files:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"my-lens.js"})," - Your enhance function (edit this file with your lens logic)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"my-lens.json"})," - FHIR Library bundle (auto-generated, don't edit directly)"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"step-2-bundle-javascript-into-fhir-library",children:"Step 2: Bundle JavaScript into FHIR Library"}),"\n",(0,i.jsxs)(n.p,{children:["After editing your ",(0,i.jsx)(n.code,{children:"my-lens.js"})," file, convert it to a FHIR Library bundle:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"lens-tool-bundler bundle my-lens.js -u\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"-u"})," flag updates the existing bundle while preserving metadata."]}),"\n",(0,i.jsxs)(n.admonition,{title:"Using package.json for Metadata",type:"tip",children:[(0,i.jsxs)(n.p,{children:["If your project has a ",(0,i.jsx)(n.code,{children:"package.json"}),", use the ",(0,i.jsx)(n.code,{children:"-p"})," flag to automatically populate metadata:"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"lens-tool-bundler bundle my-lens.js -p\n"})}),(0,i.jsxs)(n.p,{children:["This reads ",(0,i.jsx)(n.code,{children:"name"}),", ",(0,i.jsx)(n.code,{children:"version"}),", ",(0,i.jsx)(n.code,{children:"description"}),", ",(0,i.jsx)(n.code,{children:"author"}),", and ",(0,i.jsx)(n.code,{children:"license"})," from your package.json."]})]}),"\n",(0,i.jsx)(n.h2,{id:"step-3-verify-bundle-integrity",children:"Step 3: Verify Bundle Integrity"}),"\n",(0,i.jsx)(n.p,{children:"Before testing, verify that your JavaScript file matches the bundle content:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"lens-tool-bundler check my-lens.js\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Success output:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u2705 Integrity check passed: my-lens.js \u2194 my-lens.json\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Failure output:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u274c Integrity check failed: Content mismatch\n   Run 'bundle -u' to update the bundle with current JS content.\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["If integrity check fails, you modified the ",(0,i.jsx)(n.code,{children:".js"})," file but forgot to run ",(0,i.jsx)(n.code,{children:"bundle -u"}),"."]})}),"\n",(0,i.jsx)(n.h2,{id:"step-4-test-your-lens",children:"Step 4: Test Your Lens"}),"\n",(0,i.jsx)(n.p,{children:"Run comprehensive tests against real EPI and IPS samples:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"lens-tool-bundler test my-lens.json\n"})}),"\n",(0,i.jsx)(n.p,{children:"The test framework validates content preservation, FHIR structure integrity, and functionality."}),"\n",(0,i.jsxs)(n.admonition,{title:"Verbose Output",type:"tip",children:[(0,i.jsxs)(n.p,{children:["Add ",(0,i.jsx)(n.code,{children:"-v"})," flag for detailed test information including preservation percentages and full metrics:"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"lens-tool-bundler test my-lens.json -v\n"})})]}),"\n",(0,i.jsx)(n.h2,{id:"step-5-upload-to-fhir-server",children:"Step 5: Upload to FHIR Server"}),"\n",(0,i.jsx)(n.p,{children:"Deploy your lens to a FHIR R4-compliant server:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"lens-tool-bundler upload my-lens.json -d https://fhir.example.com/api/fhir\n"})}),"\n",(0,i.jsxs)(n.admonition,{title:"Important URL Format",type:"danger",children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Do NOT"})," include ",(0,i.jsx)(n.code,{children:"/Library"})," in the URL - the tool adds it automatically."]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u2705 Correct: ",(0,i.jsx)(n.code,{children:"https://fhir.example.com/api/fhir"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u274c Incorrect: ",(0,i.jsx)(n.code,{children:"https://fhir.example.com/api/fhir/Library"})]}),"\n"]})]}),"\n",(0,i.jsx)(n.p,{children:"The tool automatically:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Checks if the lens exists (searches by name)"}),"\n",(0,i.jsx)(n.li,{children:"Updates existing lens (PUT) or creates new lens (POST)"}),"\n",(0,i.jsx)(n.li,{children:"Handles FHIR-compliant operations"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"updating-your-lens",children:"Updating Your Lens"}),"\n",(0,i.jsx)(n.p,{children:"To modify an existing lens, follow the same workflow:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Edit ",(0,i.jsx)(n.code,{children:"my-lens.js"})]}),"\n",(0,i.jsxs)(n.li,{children:["Bundle: ",(0,i.jsx)(n.code,{children:"lens-tool-bundler bundle my-lens.js -u"})]}),"\n",(0,i.jsxs)(n.li,{children:["Check: ",(0,i.jsx)(n.code,{children:"lens-tool-bundler check my-lens.js"})]}),"\n",(0,i.jsxs)(n.li,{children:["Test: ",(0,i.jsx)(n.code,{children:"lens-tool-bundler test my-lens.json"})]}),"\n",(0,i.jsxs)(n.li,{children:["Upload: ",(0,i.jsx)(n.code,{children:"lens-tool-bundler upload my-lens.json -d $FHIR_SERVER"})]}),"\n"]}),"\n",(0,i.jsxs)(n.admonition,{title:"Chain Commands",type:"tip",children:[(0,i.jsx)(n.p,{children:"For efficiency, chain commands together:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"lens-tool-bundler bundle my-lens.js -u && \\\nlens-tool-bundler check my-lens.js && \\\nlens-tool-bundler test my-lens.json && \\\nlens-tool-bundler upload my-lens.json -d $FHIR_SERVER\n"})})]}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsx)(n.h3,{id:"1-keep-metadata-in-sync",children:"1. Keep Metadata in Sync"}),"\n",(0,i.jsxs)(n.p,{children:["Maintain consistency between ",(0,i.jsx)(n.code,{children:"package.json"})," and your FHIR Library metadata. Use the ",(0,i.jsx)(n.code,{children:"-p"})," flag when bundling:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"lens-tool-bundler bundle my-lens.js -p\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This automatically syncs name, version, description, author, and license from your ",(0,i.jsx)(n.code,{children:"package.json"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"2-version-control",children:"2. Version Control"}),"\n",(0,i.jsxs)(n.p,{children:["Always commit both ",(0,i.jsx)(n.code,{children:".js"})," and ",(0,i.jsx)(n.code,{children:".json"})," files together:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'git add my-lens.js my-lens.json\ngit commit -m "feat: add new lens functionality"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"3-test-before-upload",children:"3. Test Before Upload"}),"\n",(0,i.jsx)(n.p,{children:"Never skip the testing step:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u2705 Good workflow\nlens-tool-bundler bundle my-lens.js -u\nlens-tool-bundler check my-lens.js\nlens-tool-bundler test my-lens.json\nlens-tool-bundler upload my-lens.json -d $FHIR_SERVER\n\n# \u274c Bad workflow (skips testing)\nlens-tool-bundler bundle my-lens.js -u\nlens-tool-bundler upload my-lens.json -d $FHIR_SERVER\n"})}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.h3,{id:"integrity-check-failed",children:'"Integrity check failed"'}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cause"}),": JavaScript file and bundle are out of sync."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"lens-tool-bundler bundle my-lens.js -u\n"})}),"\n",(0,i.jsx)(n.h3,{id:"upload-failed-with-400",children:'"Upload failed with 400"'}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cause"}),": Incorrect URL format or server configuration."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Ensure URL does NOT include ",(0,i.jsx)(n.code,{children:"/Library"})," at the end"]}),"\n",(0,i.jsx)(n.li,{children:"Verify FHIR server is accessible"}),"\n",(0,i.jsx)(n.li,{children:"Check server logs for detailed error"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"test-failed",children:'"Test failed"'}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cause"}),": Lens functionality issues or test data problems."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": Review test output and ensure your lens logic is correct. Consult the lens development guide for best practices."]}),"\n",(0,i.jsx)(n.h2,{id:"cicd-integration",children:"CI/CD Integration"}),"\n",(0,i.jsx)(n.p,{children:"For automated lens deployment, use the Gravitate Health reusable workflow:"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Repository"}),": ",(0,i.jsx)(n.a,{href:"https://github.com/Gravitate-Health/reusable-workflows",children:"Gravitate-Health/reusable-workflows"}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"Example"}),": ",(0,i.jsx)(n.a,{href:"https://github.com/Gravitate-Health/reusable-workflows/blob/main/examples/lens-upload.yml",children:"lens-upload.yml"})]}),"\n",(0,i.jsx)(n.p,{children:"This provides a ready-to-use GitHub Actions workflow that:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Checks lens integrity"}),"\n",(0,i.jsx)(n.li,{children:"Runs comprehensive tests"}),"\n",(0,i.jsx)(n.li,{children:"Uploads to FHIR servers on success"}),"\n",(0,i.jsx)(n.li,{children:"Handles proper exit codes and error reporting"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"additional-resources",children:"Additional Resources"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Command Reference"}),": See ",(0,i.jsx)(n.a,{href:"https://github.com/Gravitate-Health/lens-tool-bundler",children:"README.md"})," for all commands and options"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Batch Operations"}),": For managing multiple lenses, check batch commands in the README"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Advanced Usage"}),": Run ",(0,i.jsx)(n.code,{children:"lens-tool-bundler help [COMMAND]"})," for detailed help"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Support"}),": ",(0,i.jsx)(n.a,{href:"https://github.com/Gravitate-Health/lens-tool-bundler/issues",children:"GitHub Issues"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"quick-reference",children:"Quick Reference"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Create new lens\nlens-tool-bundler new MyLens\n\n# Bundle JavaScript to FHIR\nlens-tool-bundler bundle my-lens.js -u\n\n# Verify integrity\nlens-tool-bundler check my-lens.js\n\n# Test lens\nlens-tool-bundler test my-lens.json\n\n# Upload to server\nlens-tool-bundler upload my-lens.json -d https://fhir.example.com/api/fhir\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Workflow Summary:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Create \u2192 Bundle \u2192 Check \u2192 Test \u2192 Upload\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,l)=>{l.d(n,{R:()=>t,x:()=>o});var s=l(6540);const i={},r=s.createContext(i);function t(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);