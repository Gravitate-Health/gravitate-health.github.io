"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[6038],{8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var i=t(6540);const s={},o=i.createContext(s);function r(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(o.Provider,{value:n},e.children)}},9704:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"tutorial-Preprocessor/Basic Annotation","title":"Basic ePI Annotation","description":"Semantic annotations in ePIs are embedded syntactically within the FHIR resource using markup language, specifically leveraging the HTML already present in the ePI\'s narrative content. The core component for achieving this is the HtmlElementLink Extension.","source":"@site/docs/tutorial-Preprocessor/2 - Basic Annotation.md","sourceDirName":"tutorial-Preprocessor","slug":"/tutorial-Preprocessor/Basic Annotation","permalink":"/docs/tutorial-Preprocessor/Basic Annotation","draft":false,"unlisted":false,"editUrl":"https://github.com/gravitate-health/gravitate-health.github.io/tree/main/docs/tutorial-Preprocessor/2 - Basic Annotation.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Develop a Basic Preprocessor","permalink":"/docs/tutorial-Preprocessor/Develop a Basic Preprocessor"},"next":{"title":"Deploying your Preprocessor","permalink":"/docs/tutorial-Preprocessor/Deploying your Preprocessor"}}');var s=t(4848),o=t(8453);const r={},a="Basic ePI Annotation",l={},c=[{value:"<code>HtmlElementLink</code> Structure",id:"htmlelementlink-structure",level:2},{value:"1. <code>extension:elementClass</code> (The Annotation Name)",id:"1-extensionelementclass-the-annotation-name",level:3},{value:"2. <code>extension:concept</code> (The Terminology Code)",id:"2-extensionconcept-the-terminology-code",level:3},{value:"3. <code>extension:type</code> (The Data Type)",id:"3-extensiontype-the-data-type",level:3},{value:"Linking the Annotation to the Narrative Text",id:"linking-the-annotation-to-the-narrative-text",level:2},{value:"Example Illustration (Conceptual)",id:"example-illustration-conceptual",level:2},{value:"Step 1: Create the Extension Metadata",id:"step-1-create-the-extension-metadata",level:3},{value:"Step 2: Modify the ePI Narrative HTML",id:"step-2-modify-the-epi-narrative-html",level:3},{value:"Practical Example in FHIR+JSON",id:"practical-example-in-fhirjson",level:3},{value:"Part 1: Composition Extensions",id:"part-1-composition-extensions",level:4},{value:"Part 2: Narrative Text References",id:"part-2-narrative-text-references",level:4}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"basic-epi-annotation",children:"Basic ePI Annotation"})}),"\n",(0,s.jsx)(n.admonition,{title:"Semantic Annotations",type:"info",children:(0,s.jsxs)(n.p,{children:["Semantic annotations in ePIs are embedded syntactically within the FHIR resource using markup language, specifically leveraging the HTML already present in the ePI's narrative content. The core component for achieving this is the ",(0,s.jsx)(n.a,{href:"https://build.fhir.org/ig/hl7-eu/gravitate-health/StructureDefinition-HtmlElementLink.html",children:(0,s.jsx)(n.code,{children:"HtmlElementLink"})})," Extension."]})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"HtmlElementLink"})," is a complex Extension designed for adding information to ePIs in the FHIR format, offering flexibility to include pictograms, images, video, or other types of information. This extension is used on the FHIR ",(0,s.jsx)(n.code,{children:"Composition"})," resource, which is the core resource for holding the narrative text of the ePI, also known as the ",(0,s.jsx)(n.strong,{children:"Patient Information Leaflet (PIL)"}),"."]}),"\n",(0,s.jsxs)(n.h2,{id:"htmlelementlink-structure",children:[(0,s.jsx)(n.code,{children:"HtmlElementLink"})," Structure"]}),"\n",(0,s.jsx)(n.p,{children:"This extension is composed of several nested elements, providing a structure to define the annotation and link it to terminology:"}),"\n",(0,s.jsxs)(n.h3,{id:"1-extensionelementclass-the-annotation-name",children:["1. ",(0,s.jsx)(n.code,{children:"extension:elementClass"})," (The Annotation Name)"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Purpose:"})," This component dictates the location in the HTML where the annotation applies."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Role in Annotation:"})," It defines the name of the annotation."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Data Type:"})," Its value is a ",(0,s.jsx)(n.code,{children:"stringValue"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"2-extensionconcept-the-terminology-code",children:["2. ",(0,s.jsx)(n.code,{children:"extension:concept"})," (The Terminology Code)"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Purpose:"})," This component holds the data to be used for the annotation."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Role in Annotation:"})," It typically represents a code from a standard terminology (e.g., SNOMED-CT) associated with the annotated text."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Data Type Flexibility:"})," The concept value (",(0,s.jsx)(n.code,{children:"value[x]"}),") is highly flexible and can be a:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"base64Binary"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"stringValue"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"url"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"CodeableReference"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"3-extensiontype-the-data-type",children:["3. ",(0,s.jsx)(n.code,{children:"extension:type"})," (The Data Type)"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Purpose:"})," This component specifies the type of data being linked, such as image, video, or text."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Data Type:"})," Its value is a ",(0,s.jsx)(n.code,{children:"CodeableConcept"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{title:"Preprocessor Responsibility",type:"note",children:(0,s.jsxs)(n.p,{children:["Preprocessors may need to add ",(0,s.jsx)(n.code,{children:"HtmlElementLink"})," extensions so that the composition of the ePI contains all concepts the preprocessor is about to add to the narrative text."]})}),"\n",(0,s.jsx)(n.h2,{id:"linking-the-annotation-to-the-narrative-text",children:"Linking the Annotation to the Narrative Text"}),"\n",(0,s.jsxs)(n.p,{children:["The crucial step for Preprocessors is understanding how the metadata defined in the ",(0,s.jsx)(n.code,{children:"HtmlElementLink"})," extension in the FHIR Composition resource links to the actual human-readable narrative text within that Composition."]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"The Linkage Mechanism:"})," The linkage is established by using the ",(0,s.jsx)(n.code,{children:"elementClass"})," value (the annotation name) and applying it as an HTML ",(0,s.jsx)(n.code,{children:"class"})," attribute within the Composition's narrative content."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"HTML Location:"})," Preprocessors modify the embedded HTML code in the FHIR resource by adding this class attribute to the appropriate HTML tags that encompass the target text segment."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Target Elements:"})," Annotation is performed by selecting portions of text for reference. This typically involves utilizing existing HTML tags like:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Headers: ",(0,s.jsx)(n.code,{children:"<h1>"}),", ",(0,s.jsx)(n.code,{children:"<h2>"}),", etc."]}),"\n",(0,s.jsxs)(n.li,{children:["Lists: ",(0,s.jsx)(n.code,{children:"<ul>"}),", ",(0,s.jsx)(n.code,{children:"<li>"})]}),"\n",(0,s.jsxs)(n.li,{children:["Paragraphs: ",(0,s.jsx)(n.code,{children:"<p>"})]}),"\n",(0,s.jsxs)(n.li,{children:["Or by wrapping arbitrary text sections using ",(0,s.jsx)(n.code,{children:"<span>"})," tags"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"example-illustration-conceptual",children:"Example Illustration (Conceptual)"}),"\n",(0,s.jsx)(n.p,{children:"Imagine a Preprocessor identifies a section of text discussing \"Drug X and Pregnancy\" that relates to the SNOMED code for 'Pregnancy Status'."}),"\n",(0,s.jsx)(n.h3,{id:"step-1-create-the-extension-metadata",children:"Step 1: Create the Extension Metadata"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["Preprocessor creates the ",(0,s.jsx)(n.code,{children:"HtmlElementLink"})," extension metadata:"]})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"extension:elementClass"})," might be set to: ",(0,s.jsx)(n.code,{children:'"pregnancy-category-D"'})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"extension:concept"})," might link to the SNOMED-CT code for Pregnancy (e.g. ",(0,s.jsx)(n.a,{href:"http://purl.bioontology.org/ontology/SNOMEDCT/77386006",children:"77386006"}),")"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"step-2-modify-the-epi-narrative-html",children:"Step 2: Modify the ePI Narrative HTML"}),"\n",(0,s.jsxs)(n.p,{children:["The Preprocessor finds the relevant paragraph in the Composition's narrative (which contains the raw text) and modifies its HTML to include the defined ",(0,s.jsx)(n.code,{children:"elementClass"})," as a ",(0,s.jsx)(n.code,{children:"class"})," attribute:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<p class="pregnancy-category-D">Studies in women have demonstrated a risk to the fetus that outweighs the benefit.</p>\n'})}),"\n",(0,s.jsxs)(n.p,{children:["The existence of the ",(0,s.jsx)(n.code,{children:"HtmlElementLink"})," entry in the Composition metadata, coupled with the matching HTML ",(0,s.jsx)(n.code,{children:"class"})," attribute in the narrative text, constitutes the complete semantic annotation, resulting in the preprocessed ePI (p(ePI)). This semantic tag allows subsequent focusing Lenses to apply logic (such as highlighting or collapsing) based on the patient's context (e.g., if the patient's IPS/PV indicates pregnancy status)."]}),"\n",(0,s.jsx)(n.h3,{id:"practical-example-in-fhirjson",children:"Practical Example in FHIR+JSON"}),"\n",(0,s.jsxs)(n.p,{children:["The Implementation Guide of Graviate-Health, already provides ",(0,s.jsx)(n.a,{href:"https://build.fhir.org/ig/hl7-eu/gravitate-health/artifacts.html#processed-epi",children:"functional examples of Preprocessed ePIs"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Let's look into ",(0,s.jsx)(n.a,{href:"https://build.fhir.org/ig/hl7-eu/gravitate-health/Bundle-processedbundlekarveabik.json.html",children:"one of these examples"})," in detail to highlight how the annotation is performed."]}),"\n",(0,s.jsx)(n.h4,{id:"part-1-composition-extensions",children:"Part 1: Composition Extensions"}),"\n",(0,s.jsx)(n.p,{children:"In the composition extensions we find:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "resourceType" : "Bundle",\n  \n  ...\n\n  "entry" : [{\n    "resource" : {\n      "resourceType" : "Composition",\n      \n      ... \n      \n      "extension" : [,\n      {\n        "extension" : [{\n          "url" : "elementClass",\n          "valueString" : "pregnancyCategory"\n        },\n        {\n          "url" : "concept",\n          "valueCodeableReference" : {\n            "concept" : {\n              "coding" : [{\n                "system" : "https://icpc2.icd.com/",\n                "code" : "W78",\n                "display" : "Pregnancy"\n              }]\n            }\n          }\n        }],\n        "url" : "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/HtmlElementLink"\n      },\n      \n      ...\n\n      ]\n    }\n  }\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.h4,{id:"part-2-narrative-text-references",children:"Part 2: Narrative Text References"}),"\n",(0,s.jsxs)(n.p,{children:["Later in the text we find references to this ",(0,s.jsx)(n.code,{children:"elementClass"})," applying the concept to a ",(0,s.jsx)(n.code,{children:"<div>"})," tag. The following snippet can be found in path ",(0,s.jsx)(n.code,{children:"entry[0].resource.text.div"}),", and ",(0,s.jsx)(n.code,{children:"entry[0].resource.section[0].section[3].text.div"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<div class=\\"pregnancyCategory\\">\n   <p><strong>Pregnancy and breast-feeding</strong></p>\n   <ul>\n      <li>If you are pregnant or breast-feeding, think you may be pregnant or are planning to have a baby, ask your doctor or pharmacist for advice before taking this medicine.</li>\n      <li>Tell your doctor immediately if you become pregnant and ask about the potential benefits and risks of your antiretroviral therapy to you and your child.</li>\n   </ul>\n   <p>If you have taken Biktarvy during your pregnancy, your doctor may request regular blood tests and other diagnostic tests to monitor the development of your child. In children whose mothers took nucleoside reverse transcriptase inhibitors (NRTIs) during pregnancy, the benefit from the protection against HIV outweighed the risk of side effects.</p>\n   <div class=\\"breastfeedingCategory\\">\n      <p><strong>Do not breast-feed during treatment with Biktarvy.</strong> This is because some of the active substances in this medicine pass into human breast milk. Breast-feeding is not recommended in women living with HIV because HIV infection can be passed on to the baby in breast milk. If you are breast-feeding, or thinking about breast-feeding, you should discuss it with your doctor as soon as possible.</p>\n   </div>\n</div>\n'})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);