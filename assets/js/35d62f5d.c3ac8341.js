"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2134],{8453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>l});var s=i(6540);const r={},t=s.createContext(r);function c(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(t.Provider,{value:n},e.children)}},8678:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"lee","title":"LEE (Lens Execution Environment)","description":"The LEE (Lens Execution Environment) is the component that executes Lens logic on p(ePI) using patient contextual data to produce the final f(ePI).","source":"@site/ref/lee.md","sourceDirName":".","slug":"/lee","permalink":"/reference/lee","draft":false,"unlisted":false,"editUrl":"https://github.com/gravitate-health/gravitate-health.github.io/tree/main/ref/lee.md","tags":[{"inline":true,"label":"focusing","permalink":"/reference/tags/focusing"},{"inline":true,"label":"lee","permalink":"/reference/tags/lee"},{"inline":true,"label":"lens-execution","permalink":"/reference/tags/lens-execution"}],"version":"current","sidebarPosition":36,"frontMatter":{"sidebar_position":36,"title":"LEE (Lens Execution Environment)","tags":["focusing","lee","lens-execution"]},"sidebar":"tutorialSidebar","previous":{"title":"Lens","permalink":"/reference/lens"},"next":{"title":"f(ePI) - Focused ePI","permalink":"/reference/f-epi"}}');var r=i(4848),t=i(8453);const c={sidebar_position:36,title:"LEE (Lens Execution Environment)",tags:["focusing","lee","lens-execution"]},l="Lens Execution Environment (LEE)",o={},a=[{value:"Purpose",id:"purpose",level:2},{value:"Execution Process",id:"execution-process",level:2},{value:"Execution Modes",id:"execution-modes",level:2},{value:"Client-Side Focusing",id:"client-side-focusing",level:3},{value:"Server-Side Focusing",id:"server-side-focusing",level:3},{value:"Security &amp; Isolation",id:"security--isolation",level:2},{value:"Integration",id:"integration",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"lens-execution-environment-lee",children:"Lens Execution Environment (LEE)"})}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.strong,{children:"LEE"})," (Lens Execution Environment) is the component that executes ",(0,r.jsx)(n.a,{href:"/reference/lens",children:"Lens"})," logic on ",(0,r.jsx)(n.a,{href:"/reference/p-epi",children:"p(ePI)"})," using patient contextual data to produce the final ",(0,r.jsx)(n.a,{href:"/reference/f-epi",children:"f(ePI)"}),"."]})}),"\n",(0,r.jsx)(n.p,{children:"The LEE provides the structure needed for lens development and execution. This structure includes the interface that lenses should follow, as well as the inputs they should expect. The LEE implements critical functions, like:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["preparing the inputs (epi, ips, and pv) for each lens, extracting the Patient Information Leaflet (PIL) from the p(ePI) and transforming it as a separate input ",(0,r.jsx)(n.code,{children:"html"})," to the first lens."]}),"\n",(0,r.jsxs)(n.li,{children:["ensuring the lenses are executed sequentially the ",(0,r.jsx)(n.code,{children:"html"})," output of each lens is the input for the next one, this allows lenses to build on top of each other and create complex adaptations."]}),"\n",(0,r.jsx)(n.li,{children:"isolating the lens execution, when the different functions of the lens are invoked, they are executed in an isolated thread. This not only improves security and robustness of the lens execution process, it also allows the LEE to impose security constraints such as timeout, limiting execution to 1 second by default, or network access (currently planned, but not implemented)."}),"\n",(0,r.jsx)(n.li,{children:"configuration of the log handling, logs can be  deactivated (useful for production environments) or independent logging for each lens can be customized (useful for development environments)."}),"\n",(0,r.jsxs)(n.li,{children:["LEE converts the final ",(0,r.jsx)(n.code,{children:"html"})," output of the lens execution back into a FHIR ",(0,r.jsx)(n.code,{children:"Composition"})," resource, embedding it within the ePI resource, as well as adding metadata, to produce the final ",(0,r.jsx)(n.a,{href:"/reference/f-epi",children:"f(ePI)"}),". This means that lens developers can focus on the adaptation logic and return the adapted content as ",(0,r.jsx)(n.code,{children:"html"}),", without needing to worry about the FHIR structure of the output, which is handled by the LEE."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Critically, LEE ensures that lenses can be developed agnostically to the ",(0,r.jsx)(n.a,{href:"/reference/focusing#execution-modes",children:"execution mode"}),", i.e. the exact same lens can operate for client-side and server-side focusing."]}),"\n",(0,r.jsx)(n.p,{children:"The LEE is offered as a NPMJS package, so client agents may download and use it, being this package the same one the Focusing Manager is using for applying lenses means the agent will obtain the same results."}),"\n",(0,r.jsx)(n.h2,{id:"purpose",children:"Purpose"}),"\n",(0,r.jsxs)(n.p,{children:["LEE provides a ",(0,r.jsx)(n.strong,{children:"sandboxed runtime environment"})," for executing ",(0,r.jsx)(n.a,{href:"/reference/lens",children:"Lens"})," JavaScript code safely and efficiently."]}),"\n",(0,r.jsx)(n.h2,{id:"execution-process",children:"Execution Process"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["invoked through the function ",(0,r.jsx)(n.code,{children:"applyLens(lensId, pEpi, ips, pv)"})]}),"\n",(0,r.jsxs)(n.li,{children:["Loads ",(0,r.jsx)(n.a,{href:"/reference/lens",children:"Lens"})," code from FHIR Library resource"]}),"\n",(0,r.jsx)(n.li,{children:"Decodes Base64 content, then interprets as UTF-8 JavaScript"}),"\n",(0,r.jsxs)(n.li,{children:["Prepares inputs: ",(0,r.jsx)(n.a,{href:"/reference/p-epi",children:"p(ePI)"}),", ",(0,r.jsx)(n.a,{href:"/reference/ips",children:"IPS"}),", ",(0,r.jsx)(n.a,{href:"/reference/persona-vector",children:"PV"})]}),"\n",(0,r.jsx)(n.li,{children:"Executes lens in isolated context"}),"\n",(0,r.jsxs)(n.li,{children:["Applies modifications to generate ",(0,r.jsx)(n.a,{href:"/reference/f-epi",children:"f(ePI)"})]}),"\n",(0,r.jsx)(n.li,{children:"Returns FHIR-compliant resource to caller"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"execution-modes",children:"Execution Modes"}),"\n",(0,r.jsx)(n.h3,{id:"client-side-focusing",children:"Client-Side Focusing"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"LEE runs in patient's browser/app, it is published as a JavaScript library that can be embedded in client applications for enhanced privacy and responsiveness."}),"\n",(0,r.jsxs)(n.li,{children:["Uses local patient data (",(0,r.jsx)(n.a,{href:"/reference/ips",children:"IPS"}),"/",(0,r.jsx)(n.a,{href:"/reference/persona-vector",children:"PV"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"Privacy-preserving (data never leaves device)"}),"\n",(0,r.jsxs)(n.li,{children:["Requires lightweight ",(0,r.jsx)(n.a,{href:"/reference/lens",children:"Lenses"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"server-side-focusing",children:"Server-Side Focusing"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["LEE is imported and run by ",(0,r.jsx)(n.a,{href:"/reference/focusing-manager",children:"Focusing Manager"})," on ",(0,r.jsx)(n.a,{href:"/reference/fosps",children:"FOSPS"})," servers"]}),"\n",(0,r.jsx)(n.li,{children:"Receives patient data from secure sources"}),"\n",(0,r.jsx)(n.li,{children:"Focusing Manager scales for concurrent users"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"security--isolation",children:"Security & Isolation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Sandboxed execution"}),": Lenses cannot access system resources"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Time limits"}),": Prevent infinite loops"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Memory limits"}),": Prevent resource exhaustion"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"API restrictions"}),": Only approved network access available"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"integration",children:"Integration"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Called by ",(0,r.jsx)(n.a,{href:"/reference/focusing-manager",children:"Focusing Manager"})]}),"\n",(0,r.jsxs)(n.li,{children:["Decodes ",(0,r.jsx)(n.a,{href:"/reference/lens",children:"Lenses"})]}),"\n",(0,r.jsxs)(n.li,{children:["Produces ",(0,r.jsx)(n.a,{href:"/reference/f-epi",children:"f(ePI)"})," for end-users"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/reference/lens",children:"Lens"})," - Executed code"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/reference/p-epi",children:"p(ePI)"})," - Input content"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/reference/f-epi",children:"f(ePI)"})," - Output result"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/reference/focusing-manager",children:"Focusing Manager"})," - Orchestrator"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/reference/attention-modification",children:"Attention Modification"})," - Primary operation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/reference/ips",children:"IPS"})," - Patient input"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/reference/persona-vector",children:"Persona Vector"})," - Context input"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);